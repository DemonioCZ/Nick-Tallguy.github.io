---
layout: doc
title: OSM Daten überprüfen
permalink: /de/coordination/review/
lang: de
category: coordination
---

OSM Daten überprüfen
==================

> Diese Anleitung kann als [review_de.odt](/files/review_de.odt) or [review_de.pdf](/files/review_de.pdf) heruntergeladen werden.  
> Gereviewed 2017-04-24  

- TOC
{:toc}

**Dieser Abschnitt beschäftigt sich mit Prozessen zum Überprüfen der Datenqualität, speziell im Kontext von Mapping Projekten direkt in OSM, wie jene des [Humanitarian OpenStreetMap Team](http://hotosm.org) in zahlreichen Ländern und [Open Cities](http://opencitiesproject.com) Projekten in Bangladesh, Sri Lanka, and Nepal. Die gezeigten Methoden können auch im anderen Kontext nützlich sein, wenn Datenqualität Review eine Rolle spielt.**

Wenn man in einem bestimmten Bereich einer Karte versucht alle Features und Attribute zu mappen, sollte man auf Fehler prüfen und die Genauigkeit der Arbeit überprüfen. In diesem Tutorial werden wir einige Methoden der Datenprüfung durcharbeiten, die einzelnen Schritte und die Gründe dahinter erklären. Ein gut organisiertes Mapping Projekt sollte alle diese Prozesse beinhalten zur Evaluierung, Korrektur und zum Berichten.

- Tägliche Überprüfungen
- Erneut Sichten
- SQL Abfragen

Da das Datenmodell und die Anzahl der Features wächst, werden Reviewmethoden immer wichtiger. Es würde z.B. nicht lange dauern und wenig Aufwand bedeuten ein Datenmodell mit nur interessanten Punkten (POIs) zu bewerten:

![Data Model POIs][]

In diesem Fall wäre die folgende Frage zu stellen:

- Wurden alle POIs in allen Standorten gemappt?
- Haben alle POIs ein Name Attribut?
- Haben alle POIs ein Typ Attribut?
- Haben alle POIs ein Telefonnummer Attribut?
Ist der Wert im Namenfeld richtig geschrieben (Groß-/Kleinschreibung)?
- Macht die Telefonnummer Sinn?

Normalerweise ist das Datenmodell viel komplexer, z.B. bei Gebäuden. Betrachte folgendes Datenmodell:

![Data Model Buildings][]

Stell dir vor du editierst tausende Gebäude mit vielen Attributen und die Analyse wird kritischer. In diesem Tutorial verwenden wir Gebäude als Beispiel, die selben Methoden können aber auch auf anderen Features angewandt werden.

Tägliche Überprüfungen
------------

Der beste Weg Daten zu prüfen und zu validieren ist auf einer regulären Basis. Dies kann täglich oder wöchentlich geschehen. Für einen Prüfer eines Mapperteams ist es eine wichtige Aufgabe, da das frühe Finden von Fehlern und schlechtem Editieren eine frühe Korrektur bedeutet und Mapper lernen sauber zu arbeiten.

Wir werden einige Methoden zur Datenprüfung mit JOSM anschauen, Einige Fragen die wir uns über unsere Daten stellen sind:

- Gibt es ***topologische*** Fehler (wie überlappende Gebäude oder inkorrekte Relationen)?
- Gibt es Fehler in den ***Tags*** (falsch geschrieben Tags, falsch verwendete Schlüssel-Werte Paare)?
- Sind die Daten ***komplett*** entsprechend des Datenmodells?

Lasst uns untersuchen wie wir in JOSM antworten auf diese Fragen finden. Wir nehmen an, dass wir die arbeit anderen untersuchen, aber der gleiche Prozess gilt auch für unsere eigene Arbeit (und sollte uns leichter fallen).

Wir verwenden eine Beispieldatendatei des Open Cities Mapping Projekts in Dhaka. Zum nachvollziehen, kann man es herunterladen: [dhaka_validation_example.osm](http://learnosm.org/files/dhaka_validation_example.osm)

**Bitte keine Änderungen zu OpenStreetMap hochladen. Diese Übungen sind nur zur Demonstrationszwecken gedacht.**

![Dhaka Example in JOSM][]

### Datenvalidierung
Der erste Schritt um Daten zu prüfen ist das Validierungswerkzeug in JOSM aufzurufen, welches automatisch die geöffneten Daten auf mögliche Fehler prüft. Dieses Werkzeug ist besonders nützlich um ***topologische*** Fehler zu finden, aber nicht ganz so nützlich um inkorrekte Tags zu finden.

- Man aktiviert das Validierungswerkzeug indem man auf den Button auf der linken Seite von JOSM klickt. (Es ist unnötig, wenn das Fenster bereits geöffnet ist)

![Validation Tool][]

Man stellt sicher, dass nichts markiert ist, indem man auf einen freien Punkt in der Karte klickt. Falls man Features selektiert hat, werden nur die markierten geprüft, wenn das Validierungswerkzeug läuft. (Manchmal möchte man nur bestimmte Features prüfen, aber gerade möchten wir die ganze Datei prüfen)
- Klicke den "Validierung" Button auf der Leiste.

![Validate Button][]

- Eine Liste mit Warnungen erscheint:

![Validation Results][]

- Ein neuer Layer erscheint, er zeigt wo sich die Fehler befinden. Man kann den Layer praktischerweise vorerst verstecken.

![Validation Layer][]

Lasst uns einige Warnungen anschauen. Man sieht die "Überschneidende Gebäude" Warnungen. Diese Warnungen bedeuten, dass sich Gebäude irgendwo überschneiden. Wähle das erste Objekt in der Liste, mache einen Rechtsklick und klicke "Auf Problem zoomen".

![Validation Zoom to Problem][]

Klicke außerdem den "Auswählen" Button am unteren Ende des Validierungsfensters, um die fraglichen Wege auszuwählen. Das zeigt, dass diese beiden Wege ein Problem haben:

![Validation Selected Ways][]

- Diesen Fehler hätten wir nie ohne das Validierungswerkzeug gefunden. Wenn man weit hinein zoomt, sieht man eine winzige Überlappung der Gebäude, was einen topologischen Fehler darstellt, da sich Gebäude normalerweise nicht überlappen. Um dies zu korrigieren, muss die mittlere Node bewegt werden. Falls sich die Gebäude tatsächlich berühren, was sie wahrscheinlich tun, kann die mittlere Node mit dem Weg verbunden werden.
- Wenn wir das korrigiert haben, können wir das Validierungswerkzeug erneut ausführen und die Warnung wird von der Liste verschwinden.

Diese automatische Datenprüfung ist eine effektive Art topologische Fehler zu korrigieren, insbesondere solche, die durch einen Menschen schwer zu finden sind. In der Liste der Validierungswarnungen sieht man, dass andere Warnungen wie "Gebäude in einem Gebäude" das Ergebnis ähnlicher Fehler sind.

Andere Warnungen wie "Kreuzende Wasserwege/Straßen" sind nicht notwendigerweise Fehler. Das zeigt, dass das Validierungswerkzeug mögliche Fehler findet, aber es wird jemand benötigt, der die Fehler auf wichtig oder unwichtig prüft.

![Validation Crossing Ways][]

Schauen wird die Warnungen unter "Ähnlich benannte Wege" an um nicht topologische Fehler zu sehen. Klicke "Auswählen" um die fraglichen Wege zu selektieren.

![Validation Select Crossing Ways][]

Siehst du den Fehler? Wir haben hier zwei unterschiedliche Straßensegmente der gleichen Straße mit leicht unterschiedlichen namen - "road" besitzt unterschiedliche Groß-/Kleinschreibung. Sie sollten den gleichen Namen haben und in diesem Fall sollte "road" groß geschrieben werden.

### Die JOSM Suche verwenden
In JOSM zu suchen ist eine mächtige Funktion um Daten zu reviewen. Man kann Suchbegriffe und Abfragen verwenden, um nur gewünschte Daten zu selektieren.

- Für die Suche geht man zu Bearbeiten -> Suchen oder drückt STRG + F auf der Tastatur.

![JOSM Menu Search][]

Man kann auf sehr viele unterschiedliche Arten hier suchen und Details und Beispiele in der Suchbox ansehen oder auf den "Hilfe" Button klicken.
- Lasst uns nun alle Gebäude auswählen. Fast jedes Gebäude hat das Tag ***building=yes*** und einige ***building=construction***. Dies bedeutet wir können folgende Abfrage bauen:

    *building = yes* OR *building=construction*

Dies selektiert alle Gebäude, aber für den Fall, dass jemand einen anderen Wert verwendet, können wir Wildcards verwenden, so dass alle Features mit dem Key ***Gebäude*** selektiert werden.

![JOSM Search String][]

- Alle Gebäude werden selektiert.

Das ist wunderbar, aber wie hilft es uns beim Datenreview? Nun, dadurch dass wir alle gleichen Typen eines Features ausgewählt haben, können wir nach falschen Tags suchen.

- Wenn man ins Eigenschaftenfenster sieht, sehen wir alle Tags eines jeden ausgewählten Objekts. Sie verwenden alle die gleichen Keys, aber da jedes Feature andere Werte hat, werden diese als *<unterschiedlich\>* gekennzeichnet.

![JOSM Search Properties][]

- Klicke auf das ***building:use*** Tag und dann "Bearbeiten".

![JOSM Search Properties Edit][]

- VORSICHT! Ändert man hier den Wert und klickt OK, ändert man diesen Tag für alle markierten Feature. **Das wäre sehr schlecht.**
- Man klickt stattdessen auf die Auswahlbox neben dem Wert.

![JOSM Search Properties Edit 2][]

- Man beachte, alle fett geschriebenen Elemente haben eine Nummer in eckigen Klammern daneben. Dies ist die Anzahl der ausgewählten Feature, welche diesen Tagwert besitzen.

Man kann dies mit dem OpenStreetMaps Tags des Datenmodells vergleichen und nach Fehler suchen. Dieser Tag repräsentiert z.B. die Nutzung des Gebäudes. Im frühen Stadium des Open Cities Dhaka Projekts (woher diese Daten stammen) war man sich unsicher, wie eine gemischte Nutzung getaggt werden soll ***building:use=multipurpose*** oder ***building:use=mixed***. Da der erste Tag in anderen Ländern bereits verwendet wurde, wurde dieser verwendet. Wie wir hier sehen wurde ein Gebäude als ***mixed*** getaggt. Wir korrigieren das. (Ein anderer offensichtlicher Fehler ist die unterschiedliche Nutzung der drei ***garage*** Begriffe, aber wir werden das hier nicht korrigieren.)

Wir können gerade das Feature mit dem Tag ***building:use=mixed*** nicht ändern, weil wir hunderte von Features ausgewählt haben. Um es zu korrigieren, müssen wir es erst finden. Wie? Erraten - mit dem Suchwerkzeug.
- Click “Cancel” to exit this dialog.  **Remember, clicking OK can be dangerous.**
- Open the Search again and enter the following query:
    *"building:use"=mixed*
- Note that the quotation marks are necessary because a colon (:) has a search meaning as well.  This should cause the one building that has this tag to be selected.  It can now be corrected to the value ***multipurpose***.

**Remember that if you are following along with this tutorial, DO NOT try to save your changes on OpenStreetMap.  These exercises are for demonstration purposes only.**


Re-Surveying
------------
When managing a project like a detailed building survey, there ought to be an additional method of quality control, both for improving the work and for reporting on the accuracy at the end of a project.

If there are many mapping teams collaborating to survey an area, it is common that one or more of the teams may not do a satisfactory job.  Even those teams that do efficient and accurate work will make mistakes.  Imagine teams that each map 100 buildings per day - it is not unlikely that a small percentage of the attributes they collect may be incorrect.

Thus, a good project will include a process of re-checking some of the work that has been done, fixing mistakes, determining which mapping teams are performing satisfactorily, and approximating the percentage of errors for a a final report.

Of course, there is no sense in re-surveying every building in a target area, but 5-10% of the buildings should be reviewed.  The areas for review should be chosen from different areas to compare between survey teams.  Survey teams can re-survey each others’ work, or if possible more experienced managers can undertake the reviews.  It is common practice that one day a week managers will spend re-surveying parts of the target area.

### Correcting Mistakes
What should be done when mistakes are found?

If there is a small amount of mistakes (less than 5% of buildings), the issues should be brought to the original mapping team so that they are aware and may not make the same mistakes again.  The data should be corrected in OpenStreetMap and the results of the re-survey should be recorded.

If there are many mistakes, bigger actions may need to be taken.  The survey team will need to be addressed in an appropriate fashion, and the areas they have mapped may even need to be resurveyed entirely, depending on how inaccurate the data proves to be.  Greater than 10% inaccuracy is most likely an unacceptable rate.

### Reporting on Accuracy
The second goal of resurveying is so that you can report on the accuracy of the data when the project closes.  Users of the data will want to know your metrics and methodologies of assessing the data quality.

By including this process as part of your reviewing methodology, you will be able to clearly explain how you assessed the data quality, and provide hard numbers that show the likely percentage of error contained in your survey data.

For example, let’s imagine that we are managing a project which maps 1000 buildings.  So we decide to map 10% of them, or 100 buildings, randomly selected from the target area.  We go out and find that of the 100 buildings we resurveyed, six of them have a high level of inaccuracy.  Let’s say we define inaccuracy by having more than one attribute incorrect.  So six percent of the resurvey is wrong - we can fix these mistakes, but we still must extrapolate that about six percent of all 1000 buildings are probably inaccurate.  This should be reported as the probable error at the close of the project.

Resurveying ought to be done throughout the project.  Imagine that we waited until the end in this example and 40 out of 100 buildings were wrong!  It might ruin the entire project.  It is better to catch large-scale mistakes early so that they can be corrected.


SQL Queries
-----------
Probably the best analysis tool is going to be running SQL Queries in a GIS system, such as Quantum GIS.  This is similar to searching for data in JOSM, but it offers more powerful analysis, though it can take a little more time to set up.  Using JOSM is a quick, regular way to check for basic errors, whereas querying in QGIS is better suited for finding missing data or incorrect attributes.

We’ll assume here that you are somewhat familiar with GIS, and focus on building queries which can help you to review OpenStreetMap data.  For the exercises below we’ll again be using data from the Open Cities Dhaka project, which you can download at [dhaka_sql.zip](http://learnosm.org/files/dhaka_sql.zip).  The OpenStreetMap data was exported using the HOT Export Tool ([export.hotosm.org](http://export.hotosm.org)) and the target area boundary was defined at the start of the project.

### Prepare the Data
Unzip the files and load the two shapefiles into QGIS.  We’ll begin by clipping only the buildings within the project area, to make our queries more simple later on.

- First let’s select only the polygons that are within the target area.  To do this we will use the Spatial Query Plugin.  If you do not already have it installed, go to Plugins -> Manage and Install Plugins to find and install it.
- Go to Vector -> Spatial Query -> Spatial Query.
- You should fill in settings to select features from **planet_osm_polygon** that are **within target_area**.

![QGIS Spatial Query][]

- Click Apply. Only polygons within the target area will be selected.

![QGIS Map Image][]

- Right-click on the layer and save the selection as a new shapefile.  Add it to the project.

![QGIS Save Selection As][]

- Next let’s filter only the polygons that are buildings and that were collected as part of this project.
- Right-click on **planet_osm_polygon** and click on “Filter...”
- Enter the following query:
    
*"building" != NULL AND "source" = 'Open Cities Dhaka Survey'*

- Click OK.  Filtering the data with this query will only show polygons that have something in the building column.  It also removes buildings that do not have the source tag associated with this project.
- Save this data as a new shapefile.  We will use this file for our SQL queries.

![QGIS Map Image 2][]

### SQL Queries
We can now run queries on the buildings layer to find possible mistakes.  Let’s think about some things that we might want to query.  The data model from this project indicates attributes that should be collected for every building - they are:

- name
- building
- building:levels
- building:use                                            
- building:vertical_irregularity
- building:soft_storey
- building:material
- building:structure
- start_date
- building:condition

Note that in the shapefile these attribute names are truncated, since column named are limited to 10 characters.

So what sort of questions do we want to ask?  What are likely mistakes?  One common mistake is that a building was mapped, but not all of the attributes were collected.  So we will want to run a query that shows all the buildings which do not have a complete set of attributes.  Of course, for some attributes, like name and start_date (construction year), it is perfectly fine for them to be empty, because not every building has a name and sometimes the construction year is unknown.  But the other attributes should always be collected.

Let’s try to develop a query for this:

- Right-click on the buildings layer (the layer we created in the previous section) and click “Filter...”  This will open the query builder.  Here we can write complex queries to return only the data we want.
- You can build your own query by double-clicking on the fields, operators, and values, or you can copy the query that we have built here:

*"building_c" = NULL OR "building_s" = NULL OR "building_l" = NULL OR "building_m" = NULL OR "vertical_i" = NULL OR "soft_store" = NULL OR "building_u" = NULL*

- Click “Test” and you will see that this query returns 125 features.  This means that of the 3500 or so buildings that have been mapped, 125 of them are missing one or more of these attributes.

![QGIS Query Result][]

- Click OK to show only those buildings that meet the conditions in the query.

![QGIS Map Image 3][]

- These buildings can then be examined more closely to identify which attributes are missing, and if they need to be resurveyed.  It is then possible to use QGIS to create a map which a re-survey team could take to correct the missing building attributes.

What are some other queries that might be of use?  Well, you may also want to check for attributes that are not contained within your data schema.  We did this in the JOSM search section.  You can use a query to find all the buildings whose attributes don’t fit within your data model.

You may also use this to look for anomalies, which are probably but not necessarily mistakes.  For example, if we open the query builder, select **building_l**, and click “All” to load all the possible attribute values, we see that most buildings have a number between one and 20 (This attribute is building:levels, the number of storeys in the building).  But there is also a 51 in there.  It seems unlikely that there will be a 51 storey building towering above everything in this area, so we can locate it and make a note to check this with the mappers.

Querying can be an effective way to look for possible mistakes in the data set.  Combined with other features of QGIS, it can be used to output maps that can be used for reviewing the data in an area.


Zusammenfassung
-------
In this tutorial we’ve gone through several effective methods of maintaining data quality during a project and done some hands-on exercises to practice reviewing OSM data.  When organizing a mapping project, or even when assessing the data in an area for personal use, these methods may come in handy.



[Data Model POIs]: /images/coordination/reviewing_osm_data_image01.png
[Data Model Buildings]: /images/coordination/reviewing_osm_data_image02.png
[Dhaka Example in JOSM]: /images/coordination/reviewing_osm_data_image03.png
[Validation Tool]: /images/coordination/reviewing_osm_data_image04.png
[Validate Button]: /images/coordination/reviewing_osm_data_image05.png
[Validation Results]: /images/coordination/reviewing_osm_data_image06.png
[Validation Layer]: /images/coordination/reviewing_osm_data_image07.png
[Validation Zoom to Problem]: /images/coordination/reviewing_osm_data_image08.png
[Validation Selected Ways]: /images/coordination/reviewing_osm_data_image09.png
[Validation Crossing Ways]: /images/coordination/reviewing_osm_data_image10.png
[Validation Select Crossing Ways]: /images/coordination/reviewing_osm_data_image11.png
[JOSM Menu Search]: /images/coordination/reviewing_osm_data_image12.png
[JOSM Search String]: /images/coordination/reviewing_osm_data_image13.png
[JOSM Search Properties]: /images/coordination/reviewing_osm_data_image14.png
[JOSM Search Properties Edit]: /images/coordination/reviewing_osm_data_image15.png
[JOSM Search Properties Edit 2]: /images/coordination/reviewing_osm_data_image16.png
[QGIS Spatial Query]: /images/coordination/reviewing_osm_data_image17.png
[QGIS Map Image]: /images/coordination/reviewing_osm_data_image18.png
[QGIS Save Selection As]: /images/coordination/reviewing_osm_data_image19.png
[QGIS Map Image 2]: /images/coordination/reviewing_osm_data_image20.png
[QGIS Query Result]: /images/coordination/reviewing_osm_data_image21.png
[QGIS Map Image 3]: /images/coordination/reviewing_osm_data_image22.png



