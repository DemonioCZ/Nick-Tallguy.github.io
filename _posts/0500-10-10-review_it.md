---
layout: doc
title: Revisione dei dati di OSM
permalink: /en/coordination/review/
lang: en
category: coordination
---

Reviewing OSM Data
==================

> Questa guida può essere scaricata come  [review_it.odt](/files/review_it.odt) or [review_it.pdf](/files/review_it.pdf)  
> Revisione 24-04-2017  

- TOC
{:toc}

**Questa sezione descrive i processi per il controllo della qualità dei dati, in particolare nel contesto di un progetto di mappatura OSM, come quelli intrapresi da [Humanitarian OpenStreetMap Team](http://hotosm.org) in vari paesi ed i progetti  [Open Cities](http://opencitiesproject.com) in Bangladesh, Sri Lanka, e Nepal. Le metodologie descritte possono essere utili anche in altri contesti, in cui sia previsto il controllo della qualità dei dati.

Quando cerchiamo di mappare un insieme complegto di caratteristiche e attributi in una specifica area, abbiamo bisogno di metodi per il controllo degli errori e di metodi per vlutare l'accuratezza del lavoro. In questo tutorial useremo diversi metodi per il controllo dei dati, spiegando i passi del processo e la loro motivazione. Un progetto di mappatura ben gestito includerà questi tre processi, sia la valutazione e correzione dei dati, sia la loro rendicontazione.

- Controlli giornalieri
- Riesame
- Query SQL

Questi metodi di revisione diventano più importanti al crescere del modello dei dati e all'aumentare del numero di caratteristiche rilevate. Per esempio, non richiederebbe molto tempo e sforzo, valutare un modello dati che riguarda solo dei punti di interesse (POI) :

![Data Model POIs][]

In questo caso le domande a cui rispondere sarebbero:

- I POI sono stati mappati in tutte le locazioni?
- Ci sono POI senza l'attributo del nome?
- CI sono POI senza l'attributo del tipo?
-  Ci sono POI senza l'attributo del numero telefonico?
- Sono indicate correttamente le lettere maiuscole nel nome?
- Il numero telefonico è valido?

DI solito un modello dati è molto più complesso, come nel caso della mappatura di edifici. Consideriamo un modello dati che include questo:

![Data Model Buildings][]

Ora potreste stare mappando migliaia di edifici che hanno molti attributi, e l'analisi diventa più critica. In questo tutorial useremo gli edifici come esempio, ma gli stessi metodi possono applicarsi anche per la revisione di altri tipi di elementi.

Controlli giornalieri
------------

Il modo più diretto di controllare i dati è di esaminarli e validarli regolarmente. Questo può essere fatto giornalmente o al massimo settimanalmente. Per il supervisore di una squadra di mappatori, questa è un'attività importante perchè rilevare il prima possibile errori e modalità sbagliate di editare significa poterli correggere e i mappatori possono imparare a fare l'attività nel modo giusto.

Ora esamineremo alcuni metodi per controllare i dati semplicemente usando JOSM. Alcune delle domande che ci facciamo sono:

- CI sono errori di ***topologia*** ( come la sovrapposizione di edifici o relazioni sbagliate)?
- Ci sono errori di ***etichettatura*** (etichette con errori di battitura, combinazioni di chiave-valore improprie) ?
- i dati sono ***completi*** rispetto al modello dei dati?

Esaminiamo come possiamo rispondere a queste domande con JOSM. Stiamo ipotizzando di esaminare il lavoro di altri, ma gli stessi processi funzionano bene (e dovrebbero essere più facili) quando esaminiamo il nostro stesso lavoro.

Useremo come esempio un file dal progetto di mappatura di Open Cities in Dhaka. Per seguirlo, scaricate questo file: dhaka_validation_example.osm](http://learnosm.org/files/dhaka_validation_example.osm)

**NON cercate di salvare le vostre modifiche in OpenStreetMap. Questi esercizi hanno solo scopo dimostrativo.**

![Dhaka Example in JOSM][]

### Validazione dei dati
Il primo passo per controllare i dati consiste nell'eseguire lo strumento di Validazione in JOSM, che controllerà i dati per errori sospetti. Questo strumento è particolarmente utile per trovare errori di ***topologia*** ma può non essere altrettanto utile per trovare etichette errate.

- Attivate lo strumento cliccando il pulsante dello strumento di Verifica nel lato sinistro di JOSM. (Questo non è necessario se il pannello di Verifica è già aperto)

![Validation Tool][]

- Poi assicuratevi che non è selezionato niente, clicando su un punto vuoto della mappa. Se avete elementi selezionati quando eseguite lo strumento di Verifica, saranno controllati solo quegli elementi. (A volte potreste voler controllare solo certi elementi, ma per ora controlleremo l'intero file)
- Cliccate il pulsante "Convalida" nel pannello.

![Validate Button][]

- Vedrete comparire una lista di segnalazioni:

![Validation Results][]

- Comparirà anche un altro Livello, che mostra dove sono gli errori. Può esservi utile nascondere questo livello, per ora.

![Validation Layer][]

Diamo un'occhiata ad alcune segnalazioni. Potete vedere che ci sono quattro segnalazioni "edifici sovrapposti". Questa segnalazione significa che degli edifici in qualche modo si sovrappongono- Selezionate il primo elemento di questa lista, fate click con il pulsante destro del mouse, e cliccate "Ingrandisci visuale su problema."

![Validation Zoom to Problem][]

Cliccate anche il pulsante "Seleziona" in fondo alla finestra di Verifica per selezionare le linee in questione. VIene così mostrato che queste due linee hanno un problema:

![Validation Selected Ways][]

- Questo è n errore che non avremmo mai notato senza lo strumento di verifica. Se zoomate parecchio vedrete che c'è una piccola sovrapposizione tra i due edifici, che è un errore topologico, perchè gli edifici solitamente non si sovrappongono uno all'altro. Per risolverlo, il nodo intermedio deve essere spostato. Se gli edifici sono a contatto, cosa probabile, il nodo intermedio può essere aggiunto alla linea.
- Una volta eseguita questa correzione, possiamo nuovamente eseguire lo strumento di Verifica e questa segnalazione non comparirà più nell'elenco.

Questo metodo di controllare automaticamente i dati è un modo efficace di correggeerre errori topologici, in particolare quelli che sarebbe difficile notare di persona. Nell'elenco delle segnalazioni di verifica potete vedere che altre segnalazioni, come "Edificio interno ad altro edificio", sono conseguenza di errori similari.

A volte delle segnalazioni, come "Corsi d'acqua/strade incrociate", non sono necessariamente degli errori. Questo indica che lo strumento di verifica è in grado di trovare possibili errori, ma richiede che qualcuno vada e veda se l'errore è importante o no.

![Validation Crossing Ways][]

Guardiamo la segnalazione sotto "Percorsi con nomi simili" per vedere un errore che non è topologico. Cliccate "Seleziona" per selezionare le due linee in questione.

![Validation Select Crossing Ways][]

Sapete dire di che errore si tratta? In quessto caso abbiamo due segmenti diversi di strada, che sono effettivamente la stessa strada, tuttavia hanno dei nomi leggermente diversi - "road" inizia in maiuscolo in una delle strade, ma non nell'altra. E' probabile che debbano avere lo stesso nome, e in questo caso la parola "road" dovrebbe iniziare in maiuscolo.

### Using JOSM Search
La ricerca in JOSM è un modo efficace di riesaminare i dati. Consente di indicare dei termini di ricerca, noti anche come query, per selezionare solo gli elementi desiderati.

- Per accedere alla ricerca, andate a Modifica -> Cerca o premete CTRL + F da tastiera.

![JOSM Menu Search][]

- Ci sono un bel po' di tipi di interrogazioni che qui potete effettuare, e potete vedere dettagli ed esempi nella stessa finestra di ricerca e cliccando sul pulsante "Aiuto".
- Per ora, selezionate tutti gli edifici. Quasi tutti gli edifici hanno l'etichetta ***building=yes*** e alcuni hanno ***building=construction***. Questo indica che possiamo costruire una query con:

    *building = yes* OR *building=construction*

- Così selezioniamo tutti gli edifici, ma nel caso qualcuno abbia associato un'etichetta sbagliata ad un edificio, possiamo usare invece un carattere jolly, che selezionerà tutti gli elementi che hanno come chiave ***building***.

![JOSM Search String][]

- Tutti gli edifici saranno selezionati.

Questo è ottimo, ma come ci aiuta ad esaminare i dati? Beh, ora che è stato selezionato tutto quello relativo ad un singolo elemento, possiamo cercare etichette errate.

- Guardate nella finestra delle Etichette - quello che vediamo sono tutte le etichette di tuttti gli oggetti selezionati. Questi condividono tutti la stessa chiave, ma siccome ogni elemento ha valori differenti, questi sono marcati come *<diversi\>*.

![JOSM Search Properties][]

- Cliccate sull'etichetta ***building:use** e poi selezionate "Modifica".

![JOSM Search Properties Edit][]

- QUI FATE ATTENZIONE! Non volete modificare il valore e cliccare OK, perchè questo cambierebbe il valore dell'etichetta per tutti gli oggetti che hanno la caratteristica 'building'. **Questo sarebbe del tutto sbagliato.**
- Cliccate invece sulla casella a discesa vicino a Valore.

![JOSM Search Properties Edit 2][]

- Notate che tutti gli elementi in grassetto hanno un numero  in parentesi vicino a loro. Questo è il numero di elementi selezionati che hanno questo valore di etichetta.

Possiamo confrontare questo con le etichette OpenStreetMap che sono state mappate nel nostro modello dati, e cercare errori. Per esempio, questa etichetta rappresenta l'utilizzo di un edificio. All'inizio nel progetto Open Cities Dhaka (da cui provengono questi dati) c'era incertezza se etichettare un edificio con uso misto con ***building:use=multipurpose*** oppure ***building:use=mixed***. Visto che la prima etichetta era stata usata precedentemente in altre nazioni, fu selezionata questa. Tuttavia, vediamo che uno degli edifici è stato etichettato con ***mixed***. Dobbiamo correggerlo (Un altro ovvio errore sono i tre valori diversi per ***garage***, ma questi li tralasciamo ora).

- Noi non possiamo cambiare ora l'elemento che ha l'etichetta ***building:use=mixed***, perchè abbiamo centinaia di oggetti selezionati. Perciò, per correggere l'errore, dobbiamo prima trovarlo. Come? Avete indovinato - con lo strumento Cerca.
- Cliccate "Annulla" per uscire da questa finestra. **RIcordate, cliccare OK può essere pericoloso.**
- Aprite di nuovo la finestra Cerca ed inserite la seguente query:
    *"building:use"=mixed*
- Notate che le virgolette sono necessarie perche i due punti (:) hanno un loro significato di ricerca. Questo farà sì che sia selezionato il solo edificio che ha questa etichetta, che ora può essere corretto con il valore ***multipurpose***.

**Ricordate che mentre seguite questo tutorial, NON provate a salvare le vostre modifiche in OpenStreetMap. Questi esercizi sono solo a scopo dimostrativo.**


Riesame
------------
Quando si gestisce un progetto come il rilevamento dettagliato dell'edificato, ci dovrebbe essere un metodo ulteriore di controllo qualità, sia per migliorare il lavoro sia per documentarne l'accuratezza alla fine del progetto,

Se ci sono molte squadre di mappatori che cooperano nel rilevamento di un'area, è probabile che una o più squadre non facciano un lavoro soddisfacente. Anche quelle squadre che fanno un lavoro efficiente ed accurato faranno degli errori. Pensa a delle squadre che mappano ciascuna 100 edifici al giorno - non è improbabile che una piccola percentuale degli attributi che rilevano sia sbagliata.

Così, un buon progetto includerà un processo di ricontrollo di parte del lavoro che è stato fatto, correzione di errori, determinare quali squadre di mappatori stanno operando in modo soddisfacente, e approssimare la percentuale di errori per la rendicontazione finale.

Of course, there is no sense in re-surveying every building in a target area, but 5-10% of the buildings should be reviewed.  The areas for review should be chosen from different areas to compare between survey teams.  Survey teams can re-survey each others’ work, or if possible more experienced managers can undertake the reviews.  It is common practice that one day a week managers will spend re-surveying parts of the target area.

### Correzione errori
Cosa si dovrebbe fare quando si trovano errori?

Se c'è un piccolo numero di errori (meno del 5% degli edifici), i problemi dovrebbero essere riportati alla squadra originaria di rilevamento, così che ne sia informata e non possa ripetere gli stessi errori nuovamente. I dati dovrebbero essere corretti in OpenStreetMap ed i risultati del nuovo rilevamento dovrebbero essere registrati.

Se ci sono molti errori, può essere necessario intraprendere azioni più significative. La squadra di rilevamento avrà bisogno di essere affrontata in modo appropriato, e le aree da lei mappate possono aver bisogno di essere completamente rilevate da capo, a seconda di quanto i dati risultino inesatti. Una inaccuratezza superiore al 10% molto probabilmente è una percentuale non accettabile.

### Rendicontazione dell'Accuratezza
The second goal of resurveying is so that you can report on the accuracy of the data when the project closes.  Users of the data will want to know your metrics and methodologies of assessing the data quality.

By including this process as part of your reviewing methodology, you will be able to clearly explain how you assessed the data quality, and provide hard numbers that show the likely percentage of error contained in your survey data.

For example, let’s imagine that we are managing a project which maps 1000 buildings.  So we decide to map 10% of them, or 100 buildings, randomly selected from the target area.  We go out and find that of the 100 buildings we resurveyed, six of them have a high level of inaccuracy.  Let’s say we define inaccuracy by having more than one attribute incorrect.  So six percent of the resurvey is wrong - we can fix these mistakes, but we still must extrapolate that about six percent of all 1000 buildings are probably inaccurate.  This should be reported as the probable error at the close of the project.

Resurveying ought to be done throughout the project.  Imagine that we waited until the end in this example and 40 out of 100 buildings were wrong!  It might ruin the entire project.  It is better to catch large-scale mistakes early so that they can be corrected.


SQL Queries
-----------
Probably the best analysis tool is going to be running SQL Queries in a GIS system, such as Quantum GIS.  This is similar to searching for data in JOSM, but it offers more powerful analysis, though it can take a little more time to set up.  Using JOSM is a quick, regular way to check for basic errors, whereas querying in QGIS is better suited for finding missing data or incorrect attributes.

We’ll assume here that you are somewhat familiar with GIS, and focus on building queries which can help you to review OpenStreetMap data.  For the exercises below we’ll again be using data from the Open Cities Dhaka project, which you can download at [dhaka_sql.zip](http://learnosm.org/files/dhaka_sql.zip).  The OpenStreetMap data was exported using the HOT Export Tool ([export.hotosm.org](http://export.hotosm.org)) and the target area boundary was defined at the start of the project.

### Prepare the Data
Unzip the files and load the two shapefiles into QGIS.  We’ll begin by clipping only the buildings within the project area, to make our queries more simple later on.

- First let’s select only the polygons that are within the target area.  To do this we will use the Spatial Query Plugin.  If you do not already have it installed, go to Plugins -> Manage and Install Plugins to find and install it.
- Go to Vector -> Spatial Query -> Spatial Query.
- You should fill in settings to select features from **planet_osm_polygon** that are **within target_area**.

![QGIS Spatial Query][]

- Click Apply. Only polygons within the target area will be selected.

![QGIS Map Image][]

- Right-click on the layer and save the selection as a new shapefile.  Add it to the project.

![QGIS Save Selection As][]

- Next let’s filter only the polygons that are buildings and that were collected as part of this project.
- Right-click on **planet_osm_polygon** and click on “Filter...”
- Enter the following query:
    
*"building" != NULL AND "source" = 'Open Cities Dhaka Survey'*

- Click OK.  Filtering the data with this query will only show polygons that have something in the building column.  It also removes buildings that do not have the source tag associated with this project.
- Save this data as a new shapefile.  We will use this file for our SQL queries.

![QGIS Map Image 2][]

### SQL Queries
We can now run queries on the buildings layer to find possible mistakes.  Let’s think about some things that we might want to query.  The data model from this project indicates attributes that should be collected for every building - they are:

- name
- building
- building:levels
- building:use                                            
- building:vertical_irregularity
- building:soft_storey
- building:material
- building:structure
- start_date
- building:condition

Note that in the shapefile these attribute names are truncated, since column named are limited to 10 characters.

So what sort of questions do we want to ask?  What are likely mistakes?  One common mistake is that a building was mapped, but not all of the attributes were collected.  So we will want to run a query that shows all the buildings which do not have a complete set of attributes.  Of course, for some attributes, like name and start_date (construction year), it is perfectly fine for them to be empty, because not every building has a name and sometimes the construction year is unknown.  But the other attributes should always be collected.

Let’s try to develop a query for this:

- Right-click on the buildings layer (the layer we created in the previous section) and click “Filter...”  This will open the query builder.  Here we can write complex queries to return only the data we want.
- You can build your own query by double-clicking on the fields, operators, and values, or you can copy the query that we have built here:

*"building_c" = NULL OR "building_s" = NULL OR "building_l" = NULL OR "building_m" = NULL OR "vertical_i" = NULL OR "soft_store" = NULL OR "building_u" = NULL*

- Click “Test” and you will see that this query returns 125 features.  This means that of the 3500 or so buildings that have been mapped, 125 of them are missing one or more of these attributes.

![QGIS Query Result][]

- Click OK to show only those buildings that meet the conditions in the query.

![QGIS Map Image 3][]

- These buildings can then be examined more closely to identify which attributes are missing, and if they need to be resurveyed.  It is then possible to use QGIS to create a map which a re-survey team could take to correct the missing building attributes.

What are some other queries that might be of use?  Well, you may also want to check for attributes that are not contained within your data schema.  We did this in the JOSM search section.  You can use a query to find all the buildings whose attributes don’t fit within your data model.

You may also use this to look for anomalies, which are probably but not necessarily mistakes.  For example, if we open the query builder, select **building_l**, and click “All” to load all the possible attribute values, we see that most buildings have a number between one and 20 (This attribute is building:levels, the number of storeys in the building).  But there is also a 51 in there.  It seems unlikely that there will be a 51 storey building towering above everything in this area, so we can locate it and make a note to check this with the mappers.

Querying can be an effective way to look for possible mistakes in the data set.  Combined with other features of QGIS, it can be used to output maps that can be used for reviewing the data in an area.


Summary
-------
In this tutorial we’ve gone through several effective methods of maintaining data quality during a project and done some hands-on exercises to practice reviewing OSM data.  When organizing a mapping project, or even when assessing the data in an area for personal use, these methods may come in handy.



[Data Model POIs]: /images/coordination/reviewing_osm_data_image01.png
[Data Model Buildings]: /images/coordination/reviewing_osm_data_image02.png
[Dhaka Example in JOSM]: /images/coordination/reviewing_osm_data_image03.png
[Validation Tool]: /images/coordination/reviewing_osm_data_image04.png
[Validate Button]: /images/coordination/reviewing_osm_data_image05.png
[Validation Results]: /images/coordination/reviewing_osm_data_image06.png
[Validation Layer]: /images/coordination/reviewing_osm_data_image07.png
[Validation Zoom to Problem]: /images/coordination/reviewing_osm_data_image08.png
[Validation Selected Ways]: /images/coordination/reviewing_osm_data_image09.png
[Validation Crossing Ways]: /images/coordination/reviewing_osm_data_image10.png
[Validation Select Crossing Ways]: /images/coordination/reviewing_osm_data_image11.png
[JOSM Menu Search]: /images/coordination/reviewing_osm_data_image12.png
[JOSM Search String]: /images/coordination/reviewing_osm_data_image13.png
[JOSM Search Properties]: /images/coordination/reviewing_osm_data_image14.png
[JOSM Search Properties Edit]: /images/coordination/reviewing_osm_data_image15.png
[JOSM Search Properties Edit 2]: /images/coordination/reviewing_osm_data_image16.png
[QGIS Spatial Query]: /images/coordination/reviewing_osm_data_image17.png
[QGIS Map Image]: /images/coordination/reviewing_osm_data_image18.png
[QGIS Save Selection As]: /images/coordination/reviewing_osm_data_image19.png
[QGIS Map Image 2]: /images/coordination/reviewing_osm_data_image20.png
[QGIS Query Result]: /images/coordination/reviewing_osm_data_image21.png
[QGIS Map Image 3]: /images/coordination/reviewing_osm_data_image22.png



